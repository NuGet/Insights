// <auto-generated />

using System;
using System.Collections.Generic;
using System.IO;
using System.Threading.Tasks;
using Knapcode.ExplorePackages;

namespace Knapcode.ExplorePackages.Worker.FindCatalogLeafItem
{
    /* Kusto DDL:

    .drop table JverCatalogLeafItems ifexists;

    .create table JverCatalogLeafItems (
        CommitId: string,
        CommitTimestamp: datetime,
        LowerId: string,
        Identity: string,
        Id: string,
        Version: string,
        Type: string,
        Url: string,
        PageUrl: string
    );

    .create table JverCatalogLeafItems ingestion csv mapping 'JverCatalogLeafItems_mapping'
    '['
        '{"Column":"CommitId","DataType":"string","Properties":{"Ordinal":0}},'
        '{"Column":"CommitTimestamp","DataType":"datetime","Properties":{"Ordinal":1}},'
        '{"Column":"LowerId","DataType":"string","Properties":{"Ordinal":2}},'
        '{"Column":"Identity","DataType":"string","Properties":{"Ordinal":3}},'
        '{"Column":"Id","DataType":"string","Properties":{"Ordinal":4}},'
        '{"Column":"Version","DataType":"string","Properties":{"Ordinal":5}},'
        '{"Column":"Type","DataType":"string","Properties":{"Ordinal":6}},'
        '{"Column":"Url","DataType":"string","Properties":{"Ordinal":7}},'
        '{"Column":"PageUrl","DataType":"string","Properties":{"Ordinal":8}}'
    ']'

    */
    partial record CatalogLeafItemRecord
    {
        public int FieldCount => 9;

        public void Write(List<string> fields)
        {
            fields.Add(CommitId);
            fields.Add(CsvUtility.FormatDateTimeOffset(CommitTimestamp));
            fields.Add(LowerId);
            fields.Add(Identity);
            fields.Add(Id);
            fields.Add(Version);
            fields.Add(Type.ToString());
            fields.Add(Url);
            fields.Add(PageUrl);
        }

        public void Write(TextWriter writer)
        {
            CsvUtility.WriteWithQuotes(writer, CommitId);
            writer.Write(',');
            writer.Write(CsvUtility.FormatDateTimeOffset(CommitTimestamp));
            writer.Write(',');
            CsvUtility.WriteWithQuotes(writer, LowerId);
            writer.Write(',');
            CsvUtility.WriteWithQuotes(writer, Identity);
            writer.Write(',');
            CsvUtility.WriteWithQuotes(writer, Id);
            writer.Write(',');
            CsvUtility.WriteWithQuotes(writer, Version);
            writer.Write(',');
            writer.Write(Type);
            writer.Write(',');
            CsvUtility.WriteWithQuotes(writer, Url);
            writer.Write(',');
            CsvUtility.WriteWithQuotes(writer, PageUrl);
            writer.WriteLine();
        }

        public async Task WriteAsync(TextWriter writer)
        {
            await CsvUtility.WriteWithQuotesAsync(writer, CommitId);
            await writer.WriteAsync(',');
            await writer.WriteAsync(CsvUtility.FormatDateTimeOffset(CommitTimestamp));
            await writer.WriteAsync(',');
            await CsvUtility.WriteWithQuotesAsync(writer, LowerId);
            await writer.WriteAsync(',');
            await CsvUtility.WriteWithQuotesAsync(writer, Identity);
            await writer.WriteAsync(',');
            await CsvUtility.WriteWithQuotesAsync(writer, Id);
            await writer.WriteAsync(',');
            await CsvUtility.WriteWithQuotesAsync(writer, Version);
            await writer.WriteAsync(',');
            await writer.WriteAsync(Type.ToString());
            await writer.WriteAsync(',');
            await CsvUtility.WriteWithQuotesAsync(writer, Url);
            await writer.WriteAsync(',');
            await CsvUtility.WriteWithQuotesAsync(writer, PageUrl);
            await writer.WriteLineAsync();
        }

        public CatalogLeafItemRecord Read(Func<string> getNextField)
        {
            return new CatalogLeafItemRecord
            {
                CommitId = getNextField(),
                CommitTimestamp = CsvUtility.ParseDateTimeOffset(getNextField()),
                LowerId = getNextField(),
                Identity = getNextField(),
                Id = getNextField(),
                Version = getNextField(),
                Type = Enum.Parse<Knapcode.ExplorePackages.CatalogLeafType>(getNextField()),
                Url = getNextField(),
                PageUrl = getNextField(),
            };
        }
    }
}
