// <auto-generated />

using System;
using System.Collections.Generic;
using System.IO;
using System.Threading.Tasks;
using Knapcode.ExplorePackages;

namespace Knapcode.ExplorePackages.Worker.OwnersToCsv
{
    /* Kusto DDL:

    .drop table JverPackageOwners;

    .create table JverPackageOwners (
        AsOfTimestamp: datetime,
        Id: string,
        Owners: string
    );

    .create table JverPackageOwners ingestion csv mapping 'JverPackageOwners_mapping'
    '['
        '{"Column":"AsOfTimestamp","DataType":"datetime","Properties":{"Ordinal":0}},'
        '{"Column":"Id","DataType":"string","Properties":{"Ordinal":1}},'
        '{"Column":"Owners","DataType":"string","Properties":{"Ordinal":2}}'
    ']'

    */
    partial record PackageOwnerRecord
    {
        public int FieldCount => 3;

        public void Write(List<string> fields)
        {
            fields.Add(CsvUtility.FormatDateTimeOffset(AsOfTimestamp));
            fields.Add(Id);
            fields.Add(Owners);
        }

        public void Write(TextWriter writer)
        {
            writer.Write(CsvUtility.FormatDateTimeOffset(AsOfTimestamp));
            writer.Write(',');
            CsvUtility.WriteWithQuotes(writer, Id);
            writer.Write(',');
            CsvUtility.WriteWithQuotes(writer, Owners);
            writer.WriteLine();
        }

        public async Task WriteAsync(TextWriter writer)
        {
            await writer.WriteAsync(CsvUtility.FormatDateTimeOffset(AsOfTimestamp));
            await writer.WriteAsync(',');
            await CsvUtility.WriteWithQuotesAsync(writer, Id);
            await writer.WriteAsync(',');
            await CsvUtility.WriteWithQuotesAsync(writer, Owners);
            await writer.WriteLineAsync();
        }

        public PackageOwnerRecord Read(Func<string> getNextField)
        {
            return new PackageOwnerRecord
            {
                AsOfTimestamp = CsvUtility.ParseDateTimeOffset(getNextField()),
                Id = getNextField(),
                Owners = getNextField(),
            };
        }
    }
}
