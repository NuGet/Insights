// <auto-generated />

// Copyright (c) .NET Foundation. All rights reserved.
// Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.

using System;
using System.Collections.Generic;
using System.IO;
using System.Threading.Tasks;
using NuGet.Insights;

namespace NuGet.Insights.Worker.ReferenceTracking
{
    /* Kusto DDL:

    .drop table TestSubjects ifexists;

    .create table TestSubjects (
        BucketKey: string,
        Id: string,
        IsOrphan: bool
    ) with (docstring = "See https://github.com/NuGet/Insights/blob/main/docs/tables/TestSubjects.md", folder = "");

    .alter-merge table TestSubjects policy retention softdelete = 30d;

    .alter table TestSubjects policy partitioning '{'
      '"PartitionKeys": ['
        '{'
          '"ColumnName": "BucketKey",'
          '"Kind": "Hash",'
          '"Properties": {'
            '"Function": "XxHash64",'
            '"MaxPartitionCount": 256'
          '}'
        '}'
      ']'
    '}';

    .create table TestSubjects ingestion csv mapping 'BlobStorageMapping'
    '['
        '{"Column":"BucketKey","DataType":"string","Properties":{"Ordinal":0}},'
        '{"Column":"Id","DataType":"string","Properties":{"Ordinal":1}},'
        '{"Column":"IsOrphan","DataType":"bool","Properties":{"Ordinal":2}}'
    ']'

    */
    partial class TestSubjectRecord
    {
        public int FieldCount => 3;

        public void WriteHeader(TextWriter writer)
        {
            writer.WriteLine("BucketKey,Id,IsOrphan");
        }

        public void Write(List<string> fields)
        {
            fields.Add(BucketKey);
            fields.Add(Id);
            fields.Add(CsvUtility.FormatBool(IsOrphan));
        }

        public void Write(TextWriter writer)
        {
            CsvUtility.WriteWithQuotes(writer, BucketKey);
            writer.Write(',');
            CsvUtility.WriteWithQuotes(writer, Id);
            writer.Write(',');
            writer.Write(CsvUtility.FormatBool(IsOrphan));
            writer.WriteLine();
        }

        public async Task WriteAsync(TextWriter writer)
        {
            await CsvUtility.WriteWithQuotesAsync(writer, BucketKey);
            await writer.WriteAsync(',');
            await CsvUtility.WriteWithQuotesAsync(writer, Id);
            await writer.WriteAsync(',');
            await writer.WriteAsync(CsvUtility.FormatBool(IsOrphan));
            await writer.WriteLineAsync();
        }

        public ICsvRecord ReadNew(Func<string> getNextField)
        {
            return new TestSubjectRecord
            {
                BucketKey = getNextField(),
                Id = getNextField(),
                IsOrphan = bool.Parse(getNextField()),
            };
        }

        public void SetEmptyStrings()
        {
            if (BucketKey is null)
            {
                BucketKey = string.Empty;
            }

            if (Id is null)
            {
                Id = string.Empty;
            }
        }
    }
}
