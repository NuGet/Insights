# SymbolPackageArchiveToCsv

Much like the [`PackageArchiveToCsv`](PackageArchiveToCsv.md) driver, this driver reads the .snupkg ZIP archive and write archive and ZIP entry metadata to CSV.

|                                    |                                                                                                                                                                                                                                                                                                        |
| ---------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `CatalogScanDriverType` enum value | `SymbolPackageArchiveToCsv`                                                                                                                                                                                                                                                                            |
| Driver implementation              | [`SymbolPackageArchiveToCsvDriver`](../../src/Worker.Logic/CatalogScan/Drivers/SymbolPackageArchiveToCsv/SymbolPackageArchiveToCsvDriver.cs)                                                                                                                                                           |
| Processing mode                    | process latest catalog leaf per package ID and version                                                                                                                                                                                                                                                 |
| Cursor dependencies                | [`LoadSymbolPackageArchive`](LoadSymbolPackageArchive.md): reads ZIP structure from table storage                                                                                                                                                                                                      |
| Components using driver output     | Kusto ingestion via [`KustoIngestionMessageProcessor`](../../src/Worker.Logic/MessageProcessors/KustoIngestion/KustoIngestionMessageProcessor.cs), since this driver produces CSV data                                                                                                                 |
| Temporary storage config           | Table Storage:<br />`CsvRecordTableName` (name prefix): holds CSV records before they are added to a CSV blob<br />`TaskStateTableName` (name prefix): tracks completion of CSV blob aggregation                                                                                                       |
| Persistent storage config          | Blob Storage:<br />`SymbolPackageArchiveContainerName`: contains CSVs for the [`SymbolPackageArchives`](../tables/SymbolPackageArchives.md) table<br />`SymbolPackageArchiveEntryContainerName`: contains CSVs for the [`SymbolPackageArchiveEntries`](../tables/SymbolPackageArchiveEntries.md) table |
| Output CSV tables                  | [`SymbolPackageArchiveEntries`](../tables/SymbolPackageArchiveEntries.md)<br />[`SymbolPackageArchives`](../tables/SymbolPackageArchives.md)                                                                                                                                                           |

## Algorithm

For each catalog leaf passed to driver, the symbol package (.snupkg) ZIP central directory, size, and HTTP response headers are fetched from Azure Table Storage. These are populated by the [`LoadSymbolPackageArchive`](LoadSymbolPackageArchive.md) driver. Unlike the [`PackageArchiveToCsv`](PackageArchiveToCsv.md) driver, a hash of the .snupkg is not calculated because no driver currently downloads the .snupkg and captures the hash. It's possible the [`NuGetPackageExplorerToCsv`](NuGetPackageExplorerToCsv.md) driver downloads the .snupkg internally but this hasn't been evaluated yet. A hash of the .snupkg is recorded from blob storage response headers, but this is not verifiable without a .snupkg download.

The ZIP central directory is enumerated. A single CSV record is produced for each .snupkg and one or more CSV records are created for each entry in the ZIP file.

Detailed ZIP information is included in the produced CSV records to aid in the debugging of esoteric ZIP archive issues.
